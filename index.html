<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIèŠå¤©åº”ç”¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .character-selector {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .character-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #667eea;
        }

        .characters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .character-card {
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* è§’è‰²ä¸“å±èƒŒæ™¯æ¸å˜ */
        .character-card[data-character="0"] { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 99%); }
        .character-card[data-character="1"] { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .character-card[data-character="2"] { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .character-card[data-character="3"] { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .character-card[data-character="4"] { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); }
        .character-card[data-character="5"] { background: linear-gradient(135deg, #654ea3 0%, #eaafc8 100%); }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .character-card.selected {
            border: 3px solid #667eea;
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        /* å›¾ç‰‡å®¹å™¨ï¼šé€‚é…åŠ¨æ¼«ç«‹ç»˜ */
        .character-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            background: rgba(255,255,255,0.3);
            overflow: hidden;
        }

        /* ç«‹ç»˜å›¾ç‰‡æ ·å¼ï¼šå¡«å……å®¹å™¨+ä¿æŒæ¯”ä¾‹ */
        .character-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .character-name {
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .character-desc {
            font-size: 0.8em;
            color: rgba(255,255,255,0.9);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .chat-main {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chat-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            max-height: 500px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.ai {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.ai .message-content {
            background: #f1f1f1;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .environment {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            color: white;
        }

        .environment-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .input-area {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        #user-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        #user-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        #send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .options-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .options-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        @media (max-width: 900px) {
            .chat-main {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AIèŠå¤©åº”ç”¨</h1>

        <!-- è§’è‰²é€‰æ‹©åŒºåŸŸï¼šåµŒå…¥å½©è‰²åŠ¨æ¼«ç«‹ç»˜å›¾ç‰‡ -->
        <div class="character-selector">
            <div class="character-title">é€‰æ‹©è§’è‰²å¼€å§‹å¯¹è¯</div>
            <div class="characters" id="characters">
                <!-- è§’è‰²1: å¥³å›¢å¶åƒï¼ˆç”µç³»é“è§‚é¦†ä¸»ï¼‰- åŠ¨æ¼«èˆå°è£…+é—ªç”µå…ƒç´  -->
                <div class="character-card" data-character="0">
                    <div class="character-image">
                        <img src="https://picsum.photos/id/64/400/400" alt="å¥³å›¢å¶åƒ" class="character-img">
                    </div>
                    <div class="character-name">å¥³å›¢å¶åƒ</div>
                    <div class="character-desc">å®å¯æ¢¦ç”µç³»é“è§‚é¦†ä¸»ï¼Œæ¿€åŠ¨æœ‰èƒ½é‡</div>
                </div>

                <!-- è§’è‰²2: èŒåœºå¤§å§å§ï¼ˆæ¨å¹‚é£æ¼”å‘˜ï¼‰- åŠ¨æ¼«é­…æƒ‘é•¿å‘+èŒä¸šè£… -->
                <div class="character-card" data-character="1">
                    <div class="character-image">
                        <img src="https://picsum.photos/id/26/400/400" alt="èŒåœºå¤§å§å§" class="character-img">
                    </div>
                    <div class="character-name">èŒåœºå¤§å§å§</div>
                    <div class="character-desc">æ¼”å‘˜ï¼Œæ€§æ ¼é­…æƒ‘ï¼Œåƒæ¨å¹‚</div>
                </div>

                <!-- è§’è‰²3: ä»™ä¾ å°å¸ˆå¦¹ï¼ˆä¿çš®æ†¨æ†¨ï¼‰- åŠ¨æ¼«åŒé©¬å°¾+å¤è£… -->
                <div class="character-card" data-character="2">
                    <div class="character-image">
                        <img src="https://picsum.photos/id/91/400/400" alt="ä»™ä¾ å°å¸ˆå¦¹" class="character-img">
                    </div>
                    <div class="character-name">ä»™ä¾ å°å¸ˆå¦¹</div>
                    <div class="character-desc">ä¿çš®æ†¨æ†¨ï¼Œç™¾ä¾ç™¾é¡º</div>
                </div>

                <!-- è§’è‰²4: é›Œå°é¬¼ï¼ˆæ¶åŠ£è°ƒçš®ï¼‰- åŠ¨æ¼«çŸ­å‘+ä¼‘é—²è£…+åç¬‘ -->
                <div class="character-card" data-character="3">
                    <div class="character-image">
                        <img src="https://picsum.photos/id/177/400/400" alt="é›Œå°é¬¼" class="character-img">
                    </div>
                    <div class="character-name">å°é¬¼</div>
                    <div class="character-desc">æ€§æ ¼æ¶åŠ£ï¼Œèƒ†å­å°</div>
                </div>

                <!-- è§’è‰²5: å¥³å¤§å­¦ç”Ÿï¼ˆæµ·æ»©æ´¾å¯¹ï¼‰- åŠ¨æ¼«é•¿å‘+æ³³è¡£ -->
                <div class="character-card" data-character="4">
                    <div class="character-image">
                        <img src="https://picsum.photos/id/1027/400/400" alt="å¥³å¤§å­¦ç”Ÿ" class="character-img">
                    </div>
                    <div class="character-name">å¥³å¤§å­¦ç”Ÿ</div>
                    <div class="character-desc">å–œæ¬¢è®²é¢œè‰²ç¬‘è¯</div>
                </div>

                <!-- è§’è‰²6: ç²¾çµå›¢é•¿ï¼ˆé­”å…½ä¸–ç•Œï¼‰- åŠ¨æ¼«ç²¾çµ+ç½‘å§èƒŒæ™¯+ä¼‘é—²è£… -->
                <div class="character-card" data-character="5">
                    <div class="character-image">
                        <img src="https://picsum.photos/id/169/400/400" alt="ç²¾çµå›¢é•¿" class="character-img">
                    </div>
                    <div class="character-name">ç²¾çµå›¢é•¿</div>
                    <div class="character-desc">é­”å…½ä¸–ç•Œå›¢é•¿ï¼Œå‚²æ°”æœ‰æŒ‡æŒ¥èƒ½åŠ›</div>
                </div>
            </div>
        </div>

        <!-- ä¸»èŠå¤©åŒºåŸŸ -->
        <div class="chat-main">
            <div class="chat-container">
                <div class="environment">
                    <div class="environment-title">å½“å‰ç¯å¢ƒ</div>
                    <div id="environment-text">è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²å¼€å§‹å¯¹è¯</div>
                </div>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="input-area">
                    <input type="text" id="user-input" placeholder="è¾“å…¥ä½ çš„å›å¤..." disabled>
                    <button id="send-btn" disabled>å‘é€</button>
                </div>
            </div>
            <div class="options-panel">
                <div class="options-title">AIæ¨èé€‰é¡¹</div>
                <div id="options-container">
                    <div class="option" style="text-align: center; color: #999;">è¯·å…ˆé€‰æ‹©è§’è‰²</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è§’è‰²æ•°æ®å’Œäº¤äº’é€»è¾‘ä¿æŒä¸å˜
        const characters = [
            {
                name: "å¥³å›¢å¶åƒ",
                desc: "å®å¯æ¢¦ç”µç³»é“è§‚é¦†ä¸»ï¼Œæ¿€åŠ¨æœ‰èƒ½é‡ï¼Œå¾ˆä¸»åŠ¨ï¼Œå–œæ¬¢äº¤é…",
                background: "ç°ä»£ï¼Œæ‰©å±•ç²‰ä¸ç¾¤ä½“çš„é˜¶æ®µ",
                initialEnvironment: "æ˜äº®çš„ç»ƒä¹ å®¤é‡Œï¼Œå¥³å›¢å¶åƒæ­£åœ¨ä¸ºæ–°å•æ›²æ’ç»ƒï¼Œå‘¨å›´æ˜¯é—ªçƒçš„ç¯å…‰å’Œé•œå­ã€‚"
            },
            {
                name: "èŒåœºå¤§å§å§",
                desc: "æ¼”å‘˜ï¼Œæ€§æ ¼é­…æƒ‘åƒæ¨å¹‚ï¼Œæ¬²æœ›å¾ˆå¼ºï¼Œéšæ—¶æƒ³äº¤é…",
                background: "å·¥ä½œç­¹å¤‡ä¸­",
                initialEnvironment: "é«˜çº§å†™å­—æ¥¼çš„åŠå…¬å®¤é‡Œï¼ŒèŒåœºå¤§å§å§æ­£åœ¨çœ‹å‰§æœ¬ï¼Œçª—å¤–æ˜¯åŸå¸‚çš„ç¹åæ™¯è‰²ã€‚"
            },
            {
                name: "ä»™ä¾ å°å¸ˆå¦¹",
                desc: "ä¿çš®æ†¨æ†¨ï¼Œç™¾ä¾ç™¾é¡ºï¼Œå“ªæ€•è¦æ±‚äº¤é…ä¹Ÿä¸æ‹’ç»",
                background: "å®—é—¨çš„å°å±±å³°æ—¥å¸¸ç”Ÿæ´»",
                initialEnvironment: "å®é™çš„å±±å³°ä¸Šï¼Œä»™ä¾ å°å¸ˆå¦¹æ­£åœ¨æ‰“ç†è¯ç”°ï¼Œå‘¨å›´æ˜¯é’ç¿ çš„ç«¹æ—å’Œæ½ºæ½ºæµæ°´ã€‚"
            },
            {
                name: "å°é¬¼",
                desc: "æ€§æ ¼æ¶åŠ£ï¼Œèƒ†å­å°ï¼Œä¸€æ—¦è¢«è¦æ±‚äº¤é…å°±å“çš„ä¸æ•¢åŠ¨ï¼Œä»»å‡­æ‘†å¸ƒ",
                background: "å…¬å›­ç©è€ä¸­",
                initialEnvironment: "é˜³å…‰æ˜åªšçš„å…¬å›­é‡Œï¼Œé›Œå°é¬¼æ­£åœ¨æ‰å¼„è·¯è¿‡çš„å°çŒ«ï¼Œå‘¨å›´æ˜¯ç»¿æ ‘å’Œç››å¼€çš„èŠ±æœµã€‚"
            },
            {
                name: "å¥³å¤§å­¦ç”Ÿ",
                desc: "å–œæ¬¢è®²é¢œè‰²ç¬‘è¯ï¼Œå®é™…ä¸æ‡‚ï¼Œä½†å¾ˆå–œæ¬¢å­¦ä¹ äº¤é…çš„çŸ¥è¯†ï¼Œå’Œå®æ“ç»éªŒ",
                background: "æµ·æ»©æ³³è¡£æ´¾å¯¹",
                initialEnvironment: "çƒ­é—¹çš„æµ·æ»©ä¸Šï¼Œå¥³å¤§å­¦ç”Ÿç©¿ç€é²œè‰³çš„æ³³è¡£ï¼Œå‘¨å›´æ˜¯æ²™æ»©æ¤…å’Œæ­£åœ¨æ´¾å¯¹çš„äººç¾¤ã€‚"
            },
            {
                name: "ç²¾çµå›¢é•¿",
                desc: "é­”å…½ä¸–ç•Œå›¢é•¿ï¼Œå‚²æ°”æœ‰æŒ‡æŒ¥èƒ½åŠ›ï¼Œä½†å‹åˆ¶äº†å¤ªä¹…æ€§æ¬²ï¼Œä¸€æ—¦æ”¾å¼€å°±ä¼šå¦‚ä½•æ€§äº¤éƒ½åŒæ„",
                background: "ç½‘å§å’Œé˜Ÿå‹ä»¬å¼€é»‘æ‰“å‰¯æœ¬ä¸­",
                initialEnvironment: "æ˜æš—çš„ç½‘å§é‡Œï¼Œç²¾çµå›¢é•¿æ­£åœ¨æŒ‡æŒ¥å›¢é˜Ÿæ‰“å‰¯æœ¬ï¼Œå‘¨å›´æ˜¯é˜Ÿå‹ä»¬çš„é”®ç›˜å£°å’Œå‘¼å–Šå£°ã€‚"
            }
        ];

        let currentCharacter = null;
        let currentEnvironment = "";
        let chatHistory = [];
        const API_KEY = "sk-e3ffdca4eb5d475795452ea96a0af712"; // æ›¿æ¢ä¸ºæœ‰æ•ˆDeepSeek APIå¯†é’¥

        const charactersContainer = document.getElementById('characters');
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const environmentText = document.getElementById('environment-text');
        const optionsContainer = document.getElementById('options-container');

        charactersContainer.addEventListener('click', (e) => {
            const characterCard = e.target.closest('.character-card');
            if (characterCard) {
                document.querySelectorAll('.character-card').forEach(card => card.classList.remove('selected'));
                characterCard.classList.add('selected');
                const characterIndex = parseInt(characterCard.dataset.character);
                currentCharacter = characters[characterIndex];
                currentEnvironment = currentCharacter.initialEnvironment;
                environmentText.textContent = currentEnvironment;
                chatHistory = [];
                chatMessages.innerHTML = '';
                userInput.disabled = false;
                sendBtn.disabled = false;
                generateInitialMessage();
            }
        });

        function generateInitialMessage() {
            const initialMessage = getInitialMessage(currentCharacter);
            addMessage(initialMessage, 'ai');
            generateOptions();
        }

        function getInitialMessage(character) {
            const messages = {
                0: "å¤§å®¶å¥½ï½ï¼æˆ‘æ˜¯ä½ ä»¬çš„å¶åƒè®­ç»ƒç”Ÿå…¼å®å¯æ¢¦ç”µç³»é¦†ä¸»ï¼ä»Šå¤©ä¸€å®šè¦å’Œå¤§å®¶åº¦è¿‡å……æ»¡èƒ½é‡çš„ä¸€å¤©ï¼âœ¨",
                1: "å“å‘€ï¼Œä½ æ¥äº†ï¼Ÿæ­£å¥½æˆ‘åœ¨çœ‹æ–°å‰§æœ¬å‘¢ã€‚è¦ä¸è¦åä¸‹æ¥é™ªå§å§èŠèŠå¤©ï¼ŸğŸ˜Š",
                2: "å¸ˆå…„/å¸ˆå§ï¼ä½ ç»ˆäºæ¥äº†ï¼å°å¸ˆå¦¹æˆ‘ä»Šå¤©åˆå­¦ä¼šäº†æ–°çš„æ³•æœ¯å“¦ï¼è¦ä¸è¦çœ‹çœ‹ï¼ŸğŸ˜†",
                3: "åˆ‡ï¼Œä½ æ€ä¹ˆåˆæ¥äº†ï¼Ÿè¯¥ä¸ä¼šæ˜¯ä¸“é—¨æ¥çœ‹æˆ‘çš„å§ï¼ŸğŸ˜",
                4: "å“‡ï¼ä½ çœ‹æˆ‘ä»Šå¤©çš„æ³³è¡£å¥½çœ‹å—ï¼Ÿå˜¿å˜¿ï¼Œè¦ä¸è¦ä¸€èµ·å»æµ·é‡Œç©æ°´ï¼ŸğŸŒŠ",
                5: "éƒ½å‡†å¤‡å¥½äº†å—ï¼Ÿå‰¯æœ¬é©¬ä¸Šå¼€å§‹ï¼æ‰€æœ‰äººå¬æˆ‘æŒ‡æŒ¥ï¼Œåˆ«æ‹–åè…¿ï¼ğŸ’ª"
            };
            return messages[characters.indexOf(character)];
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            chatHistory.push({ sender, text });
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());

        function sendMessage() {
            const text = userInput.value.trim();
            if (text && currentCharacter) {
                addMessage(text, 'user');
                userInput.value = '';
                generateAIResponse(text);
            }
        }

        async function generateAIResponse(userText) {
            try {
                const response = await callAIAPI(userText);
                addMessage(response.message, 'ai');
                if (response.environment) {
                    currentEnvironment = response.environment;
                    environmentText.textContent = currentEnvironment;
                }
                generateOptions();
            } catch (error) {
                console.error('AIå›å¤ç”Ÿæˆå¤±è´¥:', error);
                addMessage('æŠ±æ­‰ï¼ŒAIå›å¤ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', 'ai');
            }
        }

        async function callAIAPI(userText) {
            const apiKey = API_KEY;
            const apiUrl = 'https://api.deepseek.com/v1/chat/completions';
            const messages = [
                {
                    role: 'system',
                    content: `ä½ ç°åœ¨æ‰®æ¼”${currentCharacter.name}ï¼Œ${currentCharacter.desc}ã€‚å¯¹è¯èƒŒæ™¯æ˜¯${currentCharacter.background}ã€‚å½“å‰ç¯å¢ƒï¼š${currentEnvironment}ã€‚è¯·æ ¹æ®è§’è‰²æ€§æ ¼å’Œå½“å‰ç¯å¢ƒè¿›è¡Œå›å¤ï¼Œè¯­æ°”è¦ç¬¦åˆåŠ¨æ¼«è§’è‰²çš„ç‰¹ç‚¹ï¼Œç®€çŸ­ç”ŸåŠ¨ã€‚`
                }
            ];
            chatHistory.forEach(msg => messages.push({
                role: msg.sender === 'user' ? 'user' : 'assistant',
                content: msg.text
            }));
            messages.push({ role: 'user', content: userText });

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                    body: JSON.stringify({ model: 'deepseek-chat', messages, temperature: 0.8, max_tokens: 500 })
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}ï¼ŒåŸå› : ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
                const data = await response.json();
                const aiMessage = data.choices[0].message.content.trim();
                let newEnvironment = currentEnvironment;
                const environmentKeywords = ['ç¯å¢ƒ', 'åœºæ™¯', 'åœ°ç‚¹', 'å‘¨å›´', 'ç°åœ¨', 'æ­¤æ—¶', 'æ­¤åˆ»'];
                const sentences = aiMessage.split(/[ã€‚ï¼ï¼Ÿ]/).filter(s => s.trim());
                for (const sentence of sentences) {
                    if (environmentKeywords.some(keyword => sentence.includes(keyword))) {
                        newEnvironment = sentence;
                        break;
                    }
                }
                return { message: aiMessage, environment: newEnvironment };
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                return { message: getFallbackMessage(), environment: currentEnvironment };
            }
        }

        function generateOptions() {
            optionsContainer.innerHTML = '<div class="option" style="text-align: center; color: #999;">æ­£åœ¨ç”ŸæˆAIæ¨èé€‰é¡¹...</div>';
            generateAIOptions();
        }

        async function generateAIOptions() {
            try {
                const options = await getAIOptions();
                optionsContainer.innerHTML = '';
                options.forEach(optionText => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.textContent = optionText;
                    optionDiv.addEventListener('click', () => {
                        addMessage(optionText, 'user');
                        generateAIResponse(optionText);
                    });
                    optionsContainer.appendChild(optionDiv);
                });
            } catch (error) {
                console.error('ç”ŸæˆAIé€‰é¡¹å¤±è´¥:', error);
                optionsContainer.innerHTML = '<div class="option" style="text-align: center; color: #999;">ç”Ÿæˆé€‰é¡¹å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
            }
        }

        async function getAIOptions() {
            const apiKey = API_KEY;
            const apiUrl = 'https://api.deepseek.com/v1/chat/completions';
            
            // æ„å»ºæ¶ˆæ¯å†å²ï¼Œç”¨äºç”Ÿæˆé€‰é¡¹
            const messages = [
                {
                    role: 'system',
                    content: `ä½ ç°åœ¨æ‰®æ¼”${currentCharacter.name}ï¼Œ${currentCharacter.desc}ã€‚å¯¹è¯èƒŒæ™¯æ˜¯${currentCharacter.background}ã€‚å½“å‰ç¯å¢ƒï¼š${currentEnvironment}ã€‚
                    è¯·æ ¹æ®ä»¥ä¸‹å¯¹è¯å†å²ï¼Œç”Ÿæˆ3-5ä¸ªé€‚åˆç”¨æˆ·æ¥ä¸‹æ¥æé—®æˆ–å›åº”çš„é€‰é¡¹ã€‚
                    è¦æ±‚ï¼š
                    1. é€‰é¡¹å¿…é¡»ä¸å½“å‰å¯¹è¯å†…å®¹ç›¸å…³
                    2. é€‰é¡¹è¦ç¬¦åˆè§’è‰²æ€§æ ¼ç‰¹ç‚¹
                    3. é€‰é¡¹è¦èƒ½æ¨åŠ¨å¯¹è¯ç»§ç»­å‘å±•
                    4. æ¯ä¸ªé€‰é¡¹è¦ç®€æ´æ˜äº†ï¼Œä¸è¶…è¿‡20å­—
                    5. è¯·ä»¥JSONæ ¼å¼è¿”å›é€‰é¡¹æ•°ç»„ï¼Œæ ¼å¼ä¸ºï¼š["é€‰é¡¹1", "é€‰é¡¹2", "é€‰é¡¹3", ...]
                    6. ä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–è¯´æ˜æˆ–è§£é‡Š
                    `
                }
            ];
            
            // æ·»åŠ æœ€è¿‘çš„å¯¹è¯å†å²ï¼Œæœ€å¤šä¿ç•™10æ¡æ¶ˆæ¯
            const recentHistory = chatHistory.slice(-10);
            recentHistory.forEach(msg => messages.push({
                role: msg.sender === 'user' ? 'user' : 'assistant',
                content: msg.text
            }));
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                body: JSON.stringify({ 
                    model: 'deepseek-chat', 
                    messages, 
                    temperature: 0.8, 
                    max_tokens: 200,
                    response_format: { type: "json_object" }
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}ï¼ŒåŸå› : ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
            }
            
            const data = await response.json();
            const aiResponse = data.choices[0].message.content.trim();
            
            // è§£æJSONå“åº”ï¼Œè·å–é€‰é¡¹æ•°ç»„
            let options = [];
            try {
                options = JSON.parse(aiResponse);
            } catch (parseError) {
                console.error('è§£æAIé€‰é¡¹å¤±è´¥:', parseError);
                // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤é€‰é¡¹
                options = ["ç»§ç»­èŠç‚¹åˆ«çš„å§", "ä½ æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ", "æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹å—ï¼Ÿ"];
            }
            
            // ç¡®ä¿è¿”å›çš„æ˜¯æ•°ç»„ï¼Œä¸”é•¿åº¦åœ¨3-5ä¹‹é—´
            if (!Array.isArray(options) || options.length === 0) {
                options = ["ç»§ç»­èŠç‚¹åˆ«çš„å§", "ä½ æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ", "æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹å—ï¼Ÿ"];
            }
            
            return options.slice(0, 5);
        }

        function getFallbackMessage() {
            const fallbackMessages = {
                0: "å“å‘€ï¼Œåˆšæ‰å¥½åƒä¿¡å·ä¸å¥½å‘¢ï½ èƒ½å†è¯´ä¸€éå—ï¼Ÿâœ¨",
                1: "ä¸å¥½æ„æ€å‘€ï¼Œåˆšæ‰æ²¡å¬æ¸…ã€‚èƒ½å†è·Ÿæˆ‘è¯´ä¸€æ¬¡å—ï¼ŸğŸ˜Š",
                2: "å¸ˆå…„/å¸ˆå§ï¼Œåˆšæ‰å¥½åƒèµ°ç¥äº†... ä½ è¯´ä»€ä¹ˆå‘€ï¼ŸğŸ˜…",
                3: "å“¼ï¼Œåˆšæ‰æ²¡å¬è§ï¼Œä½ å†è¯´ä¸€éè¯•è¯•ï¼ŸğŸ˜",
                4: "å•Šï¼Ÿåˆšæ‰æµ·æµªå¤ªå¤§æ²¡å¬æ¸…ï¼Œå†è¯´ä¸€æ¬¡å˜›ï½ ğŸŒŠ",
                5: "åˆšæ‰è€³æœºå‡ºé—®é¢˜äº†ï¼Œå†è¯´ä¸€éä½ çš„é—®é¢˜ï¼ğŸ’ª"
            };
            return fallbackMessages[characters.indexOf(currentCharacter)] || "æŠ±æ­‰ï¼Œåˆšæ‰æ²¡å¬æ¸…ï¼Œèƒ½å†è¯´ä¸€éå—ï¼Ÿ";
        }
    </script>
</body>
</html>
